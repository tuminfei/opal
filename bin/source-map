#!/usr/bin/env ruby

js_code = <<-JS
window = {};
var sourceMap = require('source-map');
const rawSourceMap = JSON.parse(process.argv[1]);
const originalPosition = JSON.parse(process.argv[2]);

sourceMap.SourceMapConsumer.with(rawSourceMap, null, consumer => {

  console.log(consumer.sources);
  // [ 'http://example.com/www/js/one.js',
  //   'http://example.com/www/js/two.js' ]

  console.log(consumer.originalPositionFor({
    line: originalPosition[0],
    column: originalPosition[1],
  }));
  // { source: 'http://example.com/www/js/two.js',
  //   line: 2,
  //   column: 10,
  //   name: 'n' }
  // console.log(consumer.generatedPositionFor({
  //   source: 'http://example.com/www/js/two.js',
  //   line: 2,
  //   column: 10
  // }));
  // { line: 2, column: 28 }
  //
  // consumer.eachMapping(function (m) {
  //   // ...
  // });
  //
  // return computeWhatever();
});
JS

# exec({'NODE_PATH' => __dir__}, 'node', '-e', js_code, *ARGV)
exec('node', '-e', js_code, *ARGV)
